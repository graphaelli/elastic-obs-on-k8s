apiVersion: batch/v1
kind: CronJob
metadata:
  name: curltrace-elastic.co
spec:
  schedule: "* * * * 0"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: curltrace-elastic-co
              image: graph/curltrace
              imagePullPolicy: IfNotPresent
              command: ["curltrace", "http://elastic.co"]
              env:
                - name: HOST_IP
                  valueFrom:
                    fieldRef:
                      fieldPath: status.hostIP
                - name: ELASTIC_APM_SERVER_URL
                  value: "http://$(HOST_IP):8200"
          restartPolicy: OnFailure
